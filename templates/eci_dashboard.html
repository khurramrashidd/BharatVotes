{% extends "base.html" %}
{% block content %}
<div class="container mt-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2>ECI Dashboard</h2>
    
    <div class="dropdown">
      <button class="btn btn-primary dropdown-toggle" type="button" id="viewAsDropdown" data-bs-toggle="dropdown" aria-expanded="false">
        <i class="fas fa-eye me-2"></i>View As
      </button>
      <ul class="dropdown-menu" aria-labelledby="viewAsDropdown">
        <li><a class="dropdown-item" href="{{ url_for('main.eci_dashboard') }}">ECI Dashboard (Current)</a></li>
        <li><a class="dropdown-item" href="{{ url_for('main.admin_dashboard') }}">Admin Dashboard (Stats)</a></li>
        <li><a class="dropdown-item" href="{{ url_for('main.booth_dashboard') }}">Booth Officer Dashboard</a></li>
        <li><hr class="dropdown-divider"></li>
        <li><a class="dropdown-item text-danger fw-bold" href="{{ url_for('main.results_page') }}">ðŸ”´ Live Results</a></li>
      </ul>
    </div>
  </div>

  
  <div class="card p-3 shadow-sm mb-4">
    <h4>Candidate Nominations</h4>
    {% if candidates %}
      <table class="table table-bordered table-hover">
        <thead class="table-light">
          <tr>
            <th>Name</th>
            <th>Party</th>
            <th>Constituency</th>
            <th>Status</th>
            <th>Documents</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
        {% for c in candidates %}
          <tr>
            <td>{{ c.name }}</td>
            <td>{{ c.party }}</td>
            <td>{{ c.constituency }}</td>
            <td>
              {% if c.status == "Pending" %}
                <span class="badge bg-warning text-dark">Pending</span>
              {% elif c.status == "Approved" %}
                <span class="badge bg-success">Approved</span>
              {% elif c.status == "Rejected" %}
                <span class="badge bg-danger">Rejected</span>
              {% endif %}
            </td>
            <td>
              <a href="/uploads/{{ c.affidavit }}" target="_blank" class="text-decoration-none">Affidavit</a><br>
              <a href="/uploads/{{ c.property_cert }}" target="_blank" class="text-decoration-none">Property</a><br>
              <a href="/uploads/{{ c.education_cert }}" target="_blank" class="text-decoration-none">Education</a><br>
              <a href="/uploads/{{ c.criminal_record }}" target="_blank" class="text-decoration-none">Criminal</a>
            </td>
            <td>
              <a href="{{ url_for('main.approve_candidate', id=c.id) }}" class="btn btn-success btn-sm" onclick="return confirm('Are you sure you want to approve this candidate?')">Approve</a>
              <button type="button" class="btn btn-danger btn-sm" onclick="openRejectModal('{{ c.id }}', '{{ c.name }}')">Reject</button>
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    {% else %}
      <div class="alert alert-info">No nominations submitted yet.</div>
    {% endif %}
  </div>
</div>

<div class="modal fade" id="rejectModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Reject Nomination</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form id="rejectForm" method="POST">
        <div class="modal-body">
          <p>Rejecting candidate: <strong id="rejectName"></strong></p>
          <div class="mb-3">
            <label class="form-label">Reason for Rejection</label>
            <textarea name="reason" class="form-control" rows="3" required placeholder="e.g. Invalid documents"></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-danger">Confirm Reject</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
function openRejectModal(id, name) {
    var myModal = new bootstrap.Modal(document.getElementById('rejectModal'));
    document.getElementById('rejectName').textContent = name;
    document.getElementById('rejectForm').action = "/reject/" + id;
    myModal.show();
}
</script>
{% endblock %}